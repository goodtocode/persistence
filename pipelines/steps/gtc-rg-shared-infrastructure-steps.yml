parameters:
- name: armPath
  type: string 
  default: "."

steps:
  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Validate $(cognitiveServicesName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgAnalyticsName)"
        location: "$(locationName)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/cog-cognitiveservices.json"        
        csmParametersFile: "${{ parameters.armPath }}/cog-cognitiveservices.parameters.json"        
        deploymentMode: "Validation"
        overrideParameters: -name "$(cognitiveServicesName)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Deploy $(cognitiveServicesName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgAnalyticsName)"
        location: "$(locationName)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/cog-cognitiveservices.json"
        csmParametersFile: "${{ parameters.armPath }}/cog-cognitiveservices.parameters.json"
        deploymentMode: "Incremental"
        overrideParameters: -name "$(cognitiveServicesName)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Validate $(qnaName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgBotName)"
        location: "$(locationName)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/bot-botservice.json"        
        csmParametersFile: "${{ parameters.armPath }}/bot-botservice.parameters.json"        
        deploymentMode: "Validation"
        overrideParameters: -name "$(botName)" -msAppId "$(apprBotId)" -msAppValue "$(apprBotVal)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Deploy $(botName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgBotName)"
        location: "$(locationName)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/bot-botservice.json"
        csmParametersFile: "${{ parameters.armPath }}/bot-botservice.parameters.json"
        deploymentMode: "Incremental"
        overrideParameters: -name "$(botName)" -msAppId "$(apprBotId)" -msAppValue "$(apprBotVal)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Validate $(luisName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgBotName)"
        location: "$(locationName)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/luis-languageunderstanding.json"        
        csmParametersFile: "${{ parameters.armPath }}/luis-languageunderstanding.parameters.json"        
        deploymentMode: "Validation"
        overrideParameters: -name "$(luisName)" -sku "$(luisSku)" -authoringName "$(luisAuthoringName)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Deploy $(luisName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgBotName)"
        location: "$(locationName)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/luis-languageunderstanding.json"
        csmParametersFile: "${{ parameters.armPath }}/luis-languageunderstanding.parameters.json"
        deploymentMode: "Incremental"
        overrideParameters: -name "$(luisName)" -sku "$(luisSku)" -authoringName "$(luisAuthoringName)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Validate $(qnaName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgBotName)"
        location: "$(locationName)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/qna-qnamaker.json"        
        csmParametersFile: "${{ parameters.armPath }}/qna-qnamaker.parameters.json"        
        deploymentMode: "Validation"
        overrideParameters: -name "$(qnaName)" -sku "$(qnaSku)" -azureSearchSku "$(qnaSearchSku)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Deploy $(qnaName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgBotName)"
        location: "$(locationName)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/qna-qnamaker.json"
        csmParametersFile: "${{ parameters.armPath }}/qna-qnamaker.parameters.json"
        deploymentMode: "Incremental"
        overrideParameters: -name "$(qnaName)" -sku "$(qnaSku)" -azureSearchSku "$(qnaSearchSku)"